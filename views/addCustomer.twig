{% block addCustomer %}
<table border="1">
    <th colspan="2">Add Customer</th>
    <form action="/customerAdded" method="POST" onsubmit="return checkSubmit();">
        <tr>
            <td>
                <label for="ssNr">Personal Nr:</label>
            </td>
            <td>
                <input type="text" name="ssNr" id="ssNr" placeholder="YYMMDDXXXX" required>
            </td>
        </tr>
        <tr>
            <td>
                <label for="name">Name:</label>
            </td>
            <td>
                <input type="text" name="name" placeholder="Name..." required>
            </td>
        </tr>
        <tr>
            <td>
                <label for="address">Adress:</label>
            </td>
            <td>
                <input type="text" name="adress" placeholder="Adress..." required>
            </td>
            </td>
        </tr>
        <tr>
            <td>
                <label  for="postalAdress">Postal Adress:</label>
            </td>
            <td>
                <input type="text" name="postalAdress" required placeholder="Postal adress...">
            </td>
        </tr>
        <tr>
            <td>
                <label  for="phonennumber">Phonenumber:</label>
            </td>
            <td>
                <input type="text" name="phonenumber" required placeholder="Phonenumber...">
            </td>
        </tr>
        <tr>
            <td colspan="2">
                <input type="submit" value="Submit" id="submitBtn" style="width: 100%;">
            </td>
        </tr>
    </form>
        <tr>
            <td colspan="2">
                <form action="/customers" method="POST">
                    <input type="submit" value="Customers" style="width: 100%;">
                </form>
            </td>
        </tr>
</table>
<h1 id="warning" style="display: none; font-size: 15px;"></h1>
<footer>
    <script>
        
        let ssNrInput = document.getElementById("ssNr");
        ssNrInput.addEventListener('change', getSsNr);
        let warningMessage = document.getElementById("warning");
        //submitBtn = document.getElementById("submitBtn");
        //submitBtn.addEventListener("submit", return checkSubmit);
        let string = "HELLO";
        let ssNr = 0;
        let submitOk = true;
        let numbers = 0;
        let sum = 0;
        let roundUp = 0;
        let yymmdd = '';

        function getSsNr() {
            ssNr = this.value;
            numbers = ssNr.split("");
        }

        function formatSsNr() {
            numbers[0] = 2 * parseInt(numbers[0], 10);
            numbers[1] = 1 * parseInt(numbers[1], 10);
            numbers[2] = 2 * parseInt(numbers[2], 10);
            numbers[3] = 1 * parseInt(numbers[3], 10);
            numbers[4] = 2 * parseInt(numbers[4], 10);
            numbers[5] = 1 * parseInt(numbers[5], 10);
            numbers[6] = 2 * parseInt(numbers[6], 10);
            numbers[7] = 1 * parseInt(numbers[7], 10);
            numbers[8] = 2 * parseInt(numbers[8], 10);
            numbers[9] = parseInt(numbers[9], 10);

            function separateNums() {
                for (let i = 0; i < numbers.length; i++) {
                    if (numbers[i].toString(10).split("").length > 1) {
                        number = numbers[i].toString(10).split("");
                        numbers[i] = parseInt(number[0], 10) + parseInt(number[1], 10);
                    }
                }
            }

            separateNums();

            sum = numbers[0] + 
                      numbers[1] + 
                      numbers[2] + 
                      numbers[3] + 
                      numbers[4] + 
                      numbers[5] + 
                      numbers[6] + 
                      numbers[7] + 
                      numbers[8];

            roundUp = Math.ceil((sum+1)/10)*10;
        }

        function separateNums() {
            for (let i = 0; i < numbers.length; i++) {
                if (numbers[i].toString(10).split("").length > 1) {
                    number = numbers[i].toString(10).split("");
                    numbers[i] = parseInt(number[0], 10) + parseInt(number[1], 10);
                }
            }
        }

        function validateDate() {
            yymmdd = ssNr.substring(0, 6);

            year = yymmdd.substring(0, 2);
            month = yymmdd.substring(2, 4);
            day = yymmdd.substring(4, 6);

            if (year < 70 && year > 20) {
                year += 2000;
            } else {
                year += 
            }
        }

        function validateSsNr() {
            formatSsNr();
            if (!ssNr.match(/^([0-9]){2}([0-1])([0-9])([0-9]{2})([0-9]{4})$/)) {
                submitOk = false;
                warning.innerHTML = "Wrong format on personal number. Should be: YYMMDDXXXX.";
            } else if (roundUp - sum != numbers[9]) {
                submitOk = false;
                warning.innerHTML = "Seems like this is not a valid personal number. Please try again.";
            } else {
                submitOk = true;
            }
        }

      
           

        function checkSubmit() {
            validateSsNr();
            validateDate();
            if (submitOk == true) {
                return true;
            } else {
                warning.style.display = "block";
                return false;
            }
        }
        

    </script>
</footer>
{% endblock %}